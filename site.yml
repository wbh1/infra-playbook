---
  - name: bootstrap
    hosts: all 
    roles:
      - bootstrap
      - willshersystems.sshd
    vars:
      ansible_ssh_user: root
      ansible_ssh_port: 22
    tags: never, bootstrap

  - hosts: all
    become: yes
    roles:
      - oefenweb.fail2ban
      - cloudalchemy.node_exporter
    tags: common, bootstrap
  
  - hosts: grafana,vector
    become: yes
    roles:
      - role: geerlingguy.certbot
        tags: certbot
    post_tasks:
      - name: change ownership of letsencrypt dirs
        file:
          path: /etc/letsencrypt
          owner: "{{ certbot_user }}"
          recurse: yes
        when: snapd_install is changed
  
  - hosts: grafana
    become: yes
    roles:
      - role: cloudalchemy.grafana
    tags: grafana